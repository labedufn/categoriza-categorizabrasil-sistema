{% extends 'core/base.html' %}
{% load static %}
{% load bootstrap3 %}
{% block title %}{% endblock %}

{% block content %}
{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
    <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>
{% endif %}
<div class="container card">

    <div class="card-body">

        <div>
            <br>
            <div class="text-center title-heading">
                <h1>Avaliação</h1>
            </div>


            <style>
                :root {
                    --primary-orange: #FF6B35;
                    --dark-blue: #1A237E;
                    --light-orange: #FFA063;
                    --background-color: #F4F7F6;
                    --gray-text: #666;
                }

                .card {
                    width: 80%;
                }

                .title-heading {
                    color: #1a237e;
                    font-weight: bold;
                    margin: 2rem 0;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                }

                .form-container {
                    background-color: white;
                    border-radius: 12px;
                    box-shadow: 0 4px 16px rgba(26, 35, 126, 0.1);
                    padding: 2.5rem;
                    margin: 2rem auto;
                    max-width: 800px;
                    width: 90%;
                    /* Make the form container responsive */
                }

                .form-label {
                    color: #1a237e;
                    font-weight: 600;
                    margin-bottom: 0.5rem;
                }

                .form-control {
                    border: 2px solid #e0e0e0;
                    border-radius: 6px;
                    padding: 0.75rem;
                    transition: all 0.3s ease;
                    font-size: 1rem;
                    width: 100%;
                    /* Make form controls responsive */
                }

                .form-control:focus {
                    border-color: #1a237e;
                    box-shadow: 0 0 0 0.2rem rgba(26, 35, 126, 0.15);
                }

                .form-select {
                    border: 2px solid #e0e0e0 !important;
                    border-radius: 6px !important;
                    padding: 0.75rem !important;
                    transition: all 0.3s ease !important;
                    font-size: 1rem !important;
                    width: 100%;
                    /* Make select elements responsive */
                }

                .form-select option:hover {
                    background-color: #1a237e !important;
                    color: white
                }

                .form-select:focus {
                    border-color: #1a237e !important;
                    box-shadow: 0 0 0 0.2rem rgba(26, 35, 126, 0.15) !important;
                }

                .form-text {
                    color: #666 !important;
                    font-size: 0.875rem;
                    margin-top: 4rem;
                }

                /* Estilo especial para campos de senha */
                input[type="password"] {
                    letter-spacing: 0.1em;
                }

                /* Estilo para campos obrigatórios */
                .required label::after {
                    content: "*";
                    color: #ff5722;
                    margin-left: 4px;
                }

                .btn-primary {
                    background-color: #ff5722 !important;
                    border-color: #ff5722 !important;
                    color: white;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    transition: all 0.3s ease;
                    margin-top: 1rem;
                    border-radius: 6px;
                    width: 100%;
                    /* Make buttons responsive */
                }

                .btn-primary:hover {
                    background-color: #f4511e !important;
                    border-color: #f4511e !important;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(244, 81, 30, 0.2);
                }

                .botoes {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 1rem;
                    /* Add gap between buttons */
                    width: 100%;
                }

                .btn-secondary {
                    background-color: var(--dark-blue) !important;
                    border-color: var(--dark-blue) !important;
                    color: white;
                    padding: 0.75rem 2rem;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    transition: all 0.3s ease;
                    margin-top: 1rem;
                    width: 100%;
                    /* Make buttons responsive */
                }

                .btn-secondary:focus {
                    outline: none !important;
                    box-shadow: 0 4px 12px rgba(244, 81, 30, 0.2) !important;
                }

                .btn-secondary:hover {
                    background-color: #273469 !important;
                    border-color: #273469 !important;
                    transform: translateY(-3px);
                    box-shadow: 0 4px 10px rgba(26, 35, 126, 0.3);
                }

                /* Mensagens de erro */
                .invalid-feedback {
                    color: #ff5722;
                    font-size: 0.875rem;
                    margin-top: 0.25rem;
                }

                .is-invalid {
                    border-color: #ff5722 !important;
                }

                /* Animação de entrada */
                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }

                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .form {
                    animation: slideIn 0.5s ease-out;
                }

                /* Separador de seções */
                .form-section {
                    border-bottom: 2px solid #e0e0e0;
                    margin-bottom: 2rem;
                    padding-bottom: 1rem;
                }

                /* Responsividade */
                @media (max-width: 768px) {
                    .card {
                        width: 90% !important;
                        /* Increase card width on smaller screens */
                        margin: 0 auto;
                        /* Center the card */
                    }

                    .form-container {
                        padding: 1.5rem;
                        margin: 1rem;
                        border-radius: 8px;
                    }

                    .btn-primary,
                    .btn-secondary {
                        width: 100%;
                        padding: 0.75rem 1rem;
                    }

                    .botoes {
                        flex-direction: column;
                    }
                }

                @media (max-width: 576px) {
                    .card {
                        width: 95% !important;
                        /* Further increase card width on very small screens */
                    }

                    small {
                        display: none;
                    }

                    .form-container {
                        padding: 1rem;
                        margin: 0.5rem;
                    }

                    .title-heading {
                        margin: 1rem 0;
                    }

                    .title-heading h1 {
                        font-size: 1.2rem;
                    }

                    .form-control,
                    .form-select {
                        padding: 0.5rem;
                    }

                    .btn-primary,
                    .btn-secondary {
                        padding: 0.5rem 1rem;
                        font-size: xx-small;
                    }
                }

                /* Tooltip customizado */
                .tooltip {
                    background-color: #1a237e;
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 4px;
                    font-size: 0.875rem;
                }

                /* Checkbox estilizado */
                .form-check-input:checked {
                    background-color: #ff5722;
                    border-color: #ff5722;
                }
            </style>


            <div class="row">

                <div class="container">
                    <div class="row">
                        <div class="col"></div>
                        <div class="col-8">
                            <form class="form" method="post">
                                {% csrf_token %}

                                {% bootstrap_form form %}



                                <div class="botoes">

                                    <button type="submit" name="botao" class="btn btn-primary" value="salvar"
                                        id="botao_salvar">Salvar
                                        Formulario
                                    </button>
                                    {% if save_pressed == True %}
                                    <button type="button" name="botao_relatorio" class="btn btn-secondary"
                                        style="display: block;" id="botao_relatorio" data-empresa_id="{{ empresa_id }}">
                                        Gerar relatório
                                    </button>
                                    {% endif %}



                                </div>


                            </form>

                        </div>

                        <div class="col"></div>
                    </div>


                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const form = document.querySelector('form');
                    const botaoRelatorio = document.getElementById('botao_relatorio');
                    const botaoSalvar = document.getElementById('botao_salvar');


                    function desativar_campos_exeto_primeiros() {
                        const fields = ['questao1', 'questao1_descricao', 'questao2', 'questao2_descricao'
                            , 'questao3', 'questao3_descricao', 'questao4', 'questao4_descricao',
                            'questao5', 'questao5_descricao', 'questao6', 'questao6_descricao',
                            'questao7', 'questao7_descricao', 'questao8', 'questao8_descricao',
                            'questao9', 'questao9_descricao', 'questao10', 'questao10_descricao',
                            'questao11', 'questao11_descricao', 'questao12', 'questao12_descricao',
                            'questao13', 'questao13_descricao', 'questao14', 'questao14_descricao',
                            'questao15', 'questao15_descricao', 'questao16', 'questao16_descricao',
                            'questao17', 'questao17_descricao', 'questao18', 'questao18_descricao'
                            , 'questao19', 'questao19_descricao', 'questao20', 'questao20_descricao',
                            'questao21', 'questao21_descricao', 'questao22', 'questao22_descricao',
                            'questao23', 'questao23_descricao', 'questao24', 'questao24_descricao',
                            'questao25', 'questao25_descricao', 'questao26', 'questao26_descricao',
                            'questao27', 'questao27_descricao', 'questao28', 'questao28_descricao',
                            'questao29', 'questao29_descricao', 'questao30', 'questao30_descricao',
                            'questao31', 'questao31_descricao', 'questao32', 'questao32_descricao',
                            'questao33', 'questao33_descricao', 'questao34', 'questao34_descricao'
                            , 'questao35', 'questao35_descricao', 'questao36', 'questao36_descricao',
                            'questao37', 'questao37_descricao', 'questao38', 'questao38_descricao',
                            'questao39', 'questao39_descricao', 'questao40', 'questao40_descricao',
                            'questao41', 'questao41_descricao', 'questao42', 'questao42_descricao',
                            'questao43', 'questao43_descricao', 'questao44', 'questao44_descricao',
                            'questao45', 'questao45_descricao', 'questao46', 'questao46_descricao',
                            'questao47', 'questao47_descricao', 'questao48', 'questao48_descricao',
                            'questao49', 'questao49_descricao', 'questao50', 'questao50_descricao',
                            'questao51', 'questao51_descricao',
                        ]

                        // Percorre todos os campos
                        fields.forEach(field => {
                            const element = document.getElementById(`id_${field}`);
                            console.log(`id_${field}`)
                            
                            // Verifica se o elemento existe e não é um dos campos permitidos
                            if (element && !['questao1', 'questao2', 'questao3', 'questao1_descricao', 'questao2_descricao', 'questao3_descricao'].includes(field)) {
                                element.disabled = true; // Desativa o campo
                                element.value = ""
                            }

                        });
                    }


                    function atualizarCamposDescricao() {
                        const selects = form.querySelectorAll('select');
                        selects.forEach(select => {
                            const textarea = getDescricaoField(select);

                            if (textarea) {
                                if (select.value === 'IN') {
                                    textarea.disabled = false;
                                } else {
                                    textarea.disabled = true;
                                    textarea.value = ''; // limpa o campo se não for inadequado
                                }
                            }
                        });
                    }

                    // Esconde o botão de relatório ao alterar qualquer campo
                    function esconderBotaoRelatorio() {
                        if (botaoRelatorio) {
                            botaoRelatorio.style.display = 'none';
                        }
                    }
                    function getDescricaoField(questaoSelect) {
                        // Get the base field name (e.g., "questao1" from "id_questao1")
                        const baseName = questaoSelect.name.replace('questao', '');

                        // Find the corresponding description field
                        const descricaoField = document.querySelector(`[name="questao${baseName}_descricao"]`);

                        return descricaoField;
                    }



                    function valida_form() {
                        const selects = form.querySelectorAll('select');


                        selects.forEach(select => {
                            // Check if the select value is empty
                            if (select.value === '') {

                                esconderBotaoRelatorio();
                                select.classList.add('is-invalid');
                            } else if (select.value === "IN") {
                                textarea = getDescricaoField(select)
                                if (textarea.value === "") {

                                    esconderBotaoRelatorio();
                                    textarea.classList.add('is-invalid')
                                }
                            } else {
                                select.classList.remove('is-invalid');
                            }
                        });


                    }


                    form_valid = false
                    valida_form();
                    // Mostrar botão de relatório ao clicar em "Salvar Formulário"


                    // Inicializar os campos corretamente
                    atualizarCamposDescricao();

                    // Adiciona eventos nos selects
                    const selects = form.querySelectorAll('select');
                    selects.forEach(select => {
                        select.addEventListener('change', function () {
                            atualizarCamposDescricao();
                            esconderBotaoRelatorio();
                            if (select.value == "IN") {
                                if (['questao1', 'questao2', 'questao3'].includes(select.name)) {
                                    console.log("teste")
                                    desativar_campos_exeto_primeiros();
                                }
                            }

                        });
                    });

                    // Adiciona eventos de mudança em todos os inputs, selects e textareas
                    const inputs = form.querySelectorAll('input, textarea, select');
                    inputs.forEach(el => {
                        el.addEventListener('change', esconderBotaoRelatorio);
                        el.addEventListener('input', esconderBotaoRelatorio);
                    });


                })

            </script>
        </div>

        {% endblock %}